#!/bin/bash
# Recon Script v4.4 - Professional & Stealthy Scan
# By: RostamiSec

# Color Variables
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# ASCII Art Banner
echo -e "${RED}"
echo "  ____        _     _             _            "
echo " / ___| _ __ (_) __| | __ _ _ __ | |_ ___ _ __ "
echo " \___ \| '_ \| |/ _\` |/ _\` | '_ \| __/ _ \ '__|"
echo "  ___) | |_) | | (_| | (_| | | | | ||  __/ |   "
echo " |____/| .__/|_|\__,_|\__,_|_| |_|\__\___|_|   "
echo "       |_|              By RostamiSec         "
echo -e "${NC}"

# Get target domain from user
read -p "$(echo -e ${YELLOW}'Enter the target domain (e.g., example.com): '${NC})" DOMAIN
if [ -z "$DOMAIN" ]; then
    echo -e "\n${RED}[!] Error: No domain provided. Exiting.${NC}"
    exit 1
fi

# Get output directory from user
read -p "$(echo -e ${YELLOW}'Enter output directory (press Enter for current folder): '${NC})" OUTPUT_DIR
if [ -z "$OUTPUT_DIR" ]; then
    OUTPUT_DIR="."
fi

# Create results directory
RESULTS_DIR="$OUTPUT_DIR/$DOMAIN-$(date +%F)"
mkdir -p $RESULTS_DIR
TIMESTAMP=$(date +"%H-%M-%S")

echo -e "\n${BLUE}===============================================${NC}"
echo -e "${GREEN}[+] Starting reconnaissance on: ${YELLOW}$DOMAIN${NC}"
echo -e "${GREEN}[+] Saving results to: ${YELLOW}$RESULTS_DIR${NC}"
echo -e "${BLUE}===============================================${NC}\n"

# Phase 1: Subdomain Enumeration
echo -e "${YELLOW}[*] Phase 1: Finding subdomains with subfinder...${NC}"
SUBDOMAINS_FILE="$RESULTS_DIR/subdomains_$TIMESTAMP.txt"
subfinder -d $DOMAIN -silent -o $SUBDOMAINS_FILE
echo -e "${GREEN}[+] Subdomains saved to: ${YELLOW}$SUBDOMAINS_FILE${NC}"

# Phase 2: Probing for Live HTTP/HTTPS Servers
echo -e "\n${YELLOW}[*] Phase 2: Probing for live sites with httpx...${NC}"
LIVE_SITES_FILE="$RESULTS_DIR/live_sites_$TIMESTAMP.txt"
cat $SUBDOMAINS_FILE | httpx -silent -o $LIVE_SITES_FILE
echo -e "${GREEN}[+] Live sites saved to: ${YELLOW}$LIVE_SITES_FILE${NC}"

# Phase 3: Professional Port Scanning on Live Hosts
echo -e "\n${YELLOW}[*] Phase 3: Running professional Nmap scan (all ports)...${NC}"
PORTSCAN_FILE="$RESULTS_DIR/portscan_$TIMESTAMP.txt"
cat $LIVE_SITES_FILE | awk -F/ '{print $3}' | sudo nmap -iL - -sS -Pn -sV -p- --reason -T4 -oN $PORTSCAN_FILE
echo -e "${GREEN}[+] Nmap port scan results saved to: ${YELLOW}$PORTSCAN_FILE${NC}"

echo -e "\n${GREEN}âœ… Reconnaissance Complete!${NC}"
