#!/bin/bash

# ==================================================
#            Recon Script v3.0
#      Created by: Hossein Rostami & Your Mentor
# ==================================================

# تعریف متغیرهای رنگی
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# نمایش بنر
echo -e "${RED}"
echo "  ____        _     _             _            "
echo " / ___| _ __ (_) __| | __ _ _ __ | |_ ___ _ __ "
echo " \___ \| '_ \| |/ _\` |/ _\` | '_ \| __/ _ \ '__|"
echo "  ___) | |_) | | (_| | (_| | | | | ||  __/ |   "
echo " |____/| .__/|_|\__,_|\__,_|_| |_|\__\___|_|   "
echo "       |_|        By Rostami & Your Mentor    "
echo -e "${NC}"

# گرفتن ورودی از کاربر
read -p "$(echo -e ${YELLOW}'لطفا دامنه هدف را وارد کنید: '${NC})" DOMAIN

if [ -z "$DOMAIN" ]; then
    echo -e "\n${RED}خطا: هیچ دامنه‌ای وارد نشد.${NC}"
    exit 1
fi

# ساخت پوشه برای نتایج اگر وجود نداشته باشد
RESULTS_DIR="results"
mkdir -p $RESULTS_DIR

# ایجاد یک متغیر برای تاریخ و ساعت فعلی
TIMESTAMP=$(date +"%Y-%m-%d_%H-%M-%S")

echo -e "\n${BLUE}===============================================${NC}"
echo -e "${GREEN}شروع شناسایی روی دامنه: ${YELLOW}$DOMAIN${NC}"
echo -e "${BLUE}===============================================${NC}\n"

# --- فاز ۱: پیدا کردن زیردامنه‌ها ---
echo -e "${YELLOW}[*] فاز ۱: در حال پیدا کردن زیردامنه‌ها با subfinder...${NC}"
SUBDOMAINS_FILE="$RESULTS_DIR/subdomains_$TIMESTAMP.txt"
subfinder -d $DOMAIN -silent -o $SUBDOMAINS_FILE
echo -e "${GREEN}[+] زیردامنه‌ها در فایل ${YELLOW}$SUBDOMAINS_FILE${GREEN} ذخیره شدند.${NC}"

# --- فاز ۲: پیدا کردن وب‌سایت‌های زنده ---
echo -e "\n${YELLOW}[*] فاز ۲: در حال تست کردن سایت‌های زنده با httpx...${NC}"
LIVE_SITES_FILE="$RESULTS_DIR/live_sites_$TIMESTAMP.txt"
cat $SUBDOMAINS_FILE | httpx -silent -o $LIVE_SITES_FILE
echo -e "${GREEN}[+] سایت‌های زنده در فایل ${YELLOW}$LIVE_SITES_FILE${GREEN} ذخیره شدند.${NC}"

echo -e "\n${GREEN}✅ عملیات شناسایی کامل شد!${NC}"
